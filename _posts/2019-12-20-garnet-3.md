---
layout: post
title: Let's build a home server (part 3)
description: Part 3 of the series Garnet - building a home server&#58; Alpha
category: Garnet
---

### Alpha

The most common server on the Internet is webservers.
Everybody and their mother needs a personal webserver right ?

So Alpha is going to be an Apache webserver running PHP.
In addition I will add HTTPS support for the webserver with self-signed ceritificates.

**Note**: Avoid using HTTP whenever possible, HTTP connection is in plain-text and can be sniffed.

The starting point here is a fresh Debian install cloning from Debian-base and after changing hostname to alpha.

#### Apache webserver

Install Apache
```
apt-get install apache2
```

For security reason, the webserver should be run as www-data instead of root.
This means even if the server is hacked, the attackers wouldn't have root permission.

By convention, the webserver is located in /var/www/ directory and Apache default webroot is /var/www/html/.
Change correct permission of the webroot.
```
chown -R www-data:www-data /var/www/
```
Now I can edit webserver's content as www-data.

#### PHP support

Install PHP and PHP support for Apache.
```
apt-get install php libapache2-mod-php
```

#### HTTPS support

I use self-signed certificate here for demonstration, instead of default snakeoil certificate.
```
mkdir -p /etc/apache2/ssl-certs
cd /etc/apache2/ssl-certs

openssl genrsa -out alpha.key 2048
openssl req -new -key alpha.key -out alpha.csr
openssl x509 -req -days 365 -in alpha.csr -signkey alpha.key -out alpha.crt
```

Add a new HTTPS site on port 443, using the previous certificate.
```
cat << EOF > /etc/apache2/sites-available/alpha-https.conf
<VirtualHost *:443>
        ServerAdmin webmaster@localhost

        DocumentRoot /var/www/html

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on

        SSLCertificateFile      /etc/apache2/ssl-certs/alpha.crt
        SSLCertificateKeyFile   /etc/apache2/ssl-certs/alpha.key

        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                        SSLOptions +StdEnvVars
        </FilesMatch>
        <Directory /usr/lib/cgi-bin>
                        SSLOptions +StdEnvVars
        </Directory>
</VirtualHost>
EOF

ln -s ../sites-available/alpha-https.conf /etc/apache2/sites-enabled/alpha-https.conf
```

Finally, enable SSL module and restart Apache.
```
a2enmod ssl
systemctl restart apache2
```

With just that, I have created a basic functional Apache webserver with PHP and HTTPS support.

There are no actual contents here yet.
This server can be used for PHP programming, basically webdev.
Of course this could also be used for cloning later.

**Note**: I always use length 1024 for the RSA key (OpenSSL part), which works normally for Ubuntu 12.04, 16.04 and 18.04.
However in Debian 10, a newer version of OpenSSL determines that 1024 is insecure and would fail with no 
It took me exactly 6 hours to debug why my server does not run.
